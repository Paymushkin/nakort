(()=>{class t{constructor(){this.canvas=null,this.ctx=null,this.container=null,this.scrollSection=null,this.loader=null,this.totalFrames=30,this.framePrefix="ezgif-frame-",this.frameSuffix=".jpg",this.framesPath="img/frames/",this.images=[],this.loadedImages=0,this.isLoading=!1,this.isLoaded=!1,this.currentFrame=0,this.scrollProgress=0,this.ticking=!1,this.dpr=window.devicePixelRatio||1,this.canvasWidth=0,this.canvasHeight=0,this.init()}init(){if(this.scrollSection=document.querySelector(".about-scroll"),this.scrollSection&&(this.canvas=document.getElementById("scrollCanvas"),this.container=document.querySelector(".about-scroll__container"),this.loader=document.querySelector(".about-scroll__loader"),this.canvas)&&this.container&&(this.ctx=this.canvas.getContext("2d"),this.ctx)){this.setupCanvas(),this.preloadImages();let t;window.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(()=>{this.setupCanvas(),this.isLoaded&&this.drawFrame(this.currentFrame)},250)})}}setupCanvas(){var t,i;this.canvas&&this.container&&(t=window.innerWidth,i=window.innerHeight,this.canvasWidth=t,this.canvasHeight=i,this.canvas.width=t*this.dpr,this.canvas.height=i*this.dpr,this.ctx.scale(this.dpr,this.dpr),this.canvas.style.width=t+"px",this.canvas.style.height=i+"px")}async preloadImages(){if(!this.isLoading){this.isLoading=!0,this.loadedImages=0,this.images=[];var i=[];for(let t=1;t<=this.totalFrames;t++){var s=String(t).padStart(3,"0");let e=""+this.framesPath+this.framePrefix+s+this.frameSuffix;s=new Promise((i,t)=>{let s=new Image;s.onload=()=>{this.loadedImages++,this.updateLoaderProgress(),i(s)},s.onerror=()=>{console.warn("Failed to load frame: "+e);var t=new Image;t.width=1920,t.height=1080,this.loadedImages++,this.updateLoaderProgress(),i(t)},s.src=e});i.push(s)}try{this.images=await Promise.all(i),this.isLoaded=!0,this.isLoading=!1,this.hideLoader(),this.startAnimation()}catch(t){console.error("Error loading images:",t),this.isLoading=!1,this.hideLoader()}}}updateLoaderProgress(){var t,i;this.loader&&(t=Math.round(this.loadedImages/this.totalFrames*100),i=this.loader.querySelector(".about-scroll__loader-text"))&&(i.textContent=`Загрузка... ${t}%`)}hideLoader(){this.loader&&setTimeout(()=>{this.loader.classList.add("about-scroll__loader--hidden"),setTimeout(()=>{this.loader.parentNode&&this.loader.parentNode.removeChild(this.loader)},500)},300)}startAnimation(){this.isLoaded&&this.canvas&&this.ctx&&(this.drawFrame(0),window.addEventListener("scroll",()=>this.onScroll(),{passive:!0}),this.onScroll())}onScroll(){this.ticking||(window.requestAnimationFrame(()=>{this.updateScrollProgress(),this.ticking=!1}),this.ticking=!0)}updateScrollProgress(){if(this.scrollSection&&this.container){var i=window.scrollY||window.pageYOffset,s=this.scrollSection.offsetTop,e=s+this.scrollSection.offsetHeight-window.innerHeight;let t=0;t=i<s?0:e<=i?1:(i-s)/(e-s),this.scrollProgress=t;i=Math.round(t*(this.totalFrames-1));this.currentFrame=Math.max(0,Math.min(this.totalFrames-1,i)),this.isLoaded&&this.images[this.currentFrame]&&this.drawFrame(this.currentFrame)}}drawFrame(a){if(this.ctx&&this.canvas&&this.images[a]){var a=this.images[a],h=(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),a.width/a.height),r=this.canvasWidth/this.canvasHeight;let t=this.canvasWidth,i=this.canvasHeight,s=0,e=0;r<h?(i=this.canvasWidth/h,e=(this.canvasHeight-i)/2):(t=this.canvasHeight*h,s=(this.canvasWidth-t)/2),this.ctx.drawImage(a,s,e,t,i)}}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{new t}):new t})();
//# sourceMappingURL=about-scroll.min.js.map
